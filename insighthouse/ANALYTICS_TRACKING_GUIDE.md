# üìä Guia de Rastreamento Anal√≠tico - InsightHouse

## üéØ VIS√ÉO GERAL

Este documento detalha **TODOS** os eventos capturados pelo sistema de analytics, incluindo:
- ‚úÖ Todos os filtros de busca (quartos, su√≠tes, banheiros, vagas, valores, switches)
- ‚úÖ Rastreamento de jornada do usu√°rio (user journey)
- ‚úÖ Funil de convers√£o completo
- ‚úÖ Sess√µes e persist√™ncia entre visitas

---

## üì¶ ARQUIVOS DE SCRIPT

### **1. `capture-filtros.js` (ORIGINAL)**
Script b√°sico que captura:
- Finalidade (venda/aluguel)
- Tipos de im√≥vel
- Cidades e bairros
- Sliders (valores e √°rea)
- Alguns switches b√°sicos
- Convers√µes (WhatsApp, telefone, email)

### **2. `capture-filtros-enhanced.js` (NOVO - COMPLETO)**
Script aprimorado que captura **TUDO**:
- ‚úÖ Todos os itens do script original
- ‚úÖ **Quartos, Su√≠tes, Banheiros, Vagas** (checkboxes e radios)
- ‚úÖ **Inputs manuais de valor e √°rea**
- ‚úÖ **Todos os switches** (mobiliado, ofertas, pet friendly, etc.)
- ‚úÖ **Comodidades** (ar condicionado, lareira, sauna, etc.)
- ‚úÖ **Lazer** (churrasqueira, piscina, academia, etc.)
- ‚úÖ **C√¥modos** (√°rea de servi√ßo, varanda)
- ‚úÖ **Seguran√ßa** (alarme, interfone, portaria 24h, etc.)
- ‚úÖ **Filtros comerciais** (salas, galp√µes)
- ‚úÖ **User Journey** (rastreamento persistente do usu√°rio)
- ‚úÖ **Sess√µes** (com timeout de 30 minutos)
- ‚úÖ **Funnel de convers√£o** (stages completos)
- ‚úÖ **Scroll depth** (25%, 50%, 75%, 100%)
- ‚úÖ **Time on page** (tempo em cada p√°gina)

---

## üîç EVENTOS CAPTURADOS - DETALHAMENTO

### **1. FILTROS B√ÅSICOS**

#### **search_filter_changed**
Disparado quando qualquer filtro b√°sico muda.

**Campos capturados:**
```javascript
{
  field: "finalidade",
  value: "venda" | "aluguel",
  user_id: "user_123...",
  session_id: "session_456...",
  page_depth: 3,
  time_on_site: 120, // seconds
  returning_visitor: true
}
```

**Filtros que disparam este evento:**
- `finalidade` - Venda ou Aluguel
- `tipo` - Tipos de im√≥vel selecionados
- `cidade` - Cidades selecionadas
- `bairro` - Bairros/Condom√≠nios selecionados

---

### **2. FILTROS AVAN√áADOS - QUARTOS, SU√çTES, BANHEIROS, VAGAS**

#### **search_filter_group_changed**
Disparado quando checkbox groups mudam (quartos, su√≠tes, etc.).

**Exemplo - Selecionou 2 e 3 quartos:**
```javascript
{
  field: "quartos",
  selected: ["2", "3"],
  count: 2,
  user_id: "user_123...",
  session_id: "session_456...",
  // ... journey context
}
```

**Campos capturados:**
- `quartos` - Dormit√≥rios selecionados (`dormitorios[]`)
- `suites` - Su√≠tes selecionadas (`suites[]`)
- `banheiros` - Banheiros selecionados (`banheiros[]`)
- `vagas` - Vagas selecionadas (`vagas[]`)
- `salas_comercial` - Salas (im√≥veis comerciais)
- `galpoes` - Galp√µes (im√≥veis comerciais)

---

### **3. FAIXAS DE VALORES E √ÅREA (SLIDERS)**

#### **search_filter_range_changed**
Disparado quando sliders de valor ou √°rea mudam.

**Exemplo - Pre√ßo de R$ 200k a R$ 500k:**
```javascript
{
  field: "preco_venda",
  min: "200000",
  max: "500000",
  raw_value: "200000,500000",
  user_id: "user_123...",
  // ... journey context
}
```

**Sliders capturados:**
- `preco_venda` - Faixa de pre√ßo para venda
- `preco_aluguel` - Faixa de pre√ßo para aluguel
- `area` - Faixa de √°rea em m¬≤

---

### **4. INPUTS MANUAIS (NOVO)**

#### **search_filter_manual_input**
Disparado quando usu√°rio digita valores manualmente.

**Exemplo:**
```javascript
{
  field: "preco_min_manual",
  value: "250000",
  user_id: "user_123...",
  // ... journey context
}
```

**Inputs capturados:**
- `preco_min_manual` - Valor m√≠nimo digitado
- `preco_max_manual` - Valor m√°ximo digitado
- `area_min_manual` - √Årea m√≠nima digitada
- `area_max_manual` - √Årea m√°xima digitada

---

### **5. SWITCHES/TOGGLES**

#### **search_filter_toggle**
Disparado quando qualquer switch √© ligado/desligado.

**Exemplo - Ativou "Pet Friendly":**
```javascript
{
  field: "pet_friendly",
  enabled: true,
  value: "Sim",
  user_id: "user_123...",
  // ... journey context
}
```

**Switches capturados:**

| Switch | Campo | Descri√ß√£o |
|--------|-------|-----------|
| `filtermobiliado` | `mobiliado` | Im√≥vel mobiliado |
| `filtersemimobiliado` | `semi_mobiliado` | Semi mobiliado |
| `filterpromocao` | `promocao_ofertas` | Ofertas/Promo√ß√µes |
| `filternovo` | `imovel_novo` | Im√≥vel novo |
| `filternaplanta` | `na_planta` | Na planta |
| `filterconstrucao` | `em_construcao` | Em constru√ß√£o |
| `filterpermuta` | `aceita_permuta` | Estuda permuta |
| `filterpet` | `pet_friendly` | Aceita pets |
| `filtersegfianca` | `seguro_fianca` | Aceita seguro fian√ßa |
| `filterproposta` | `reservado` | Im√≥vel reservado |
| `filterpacote` | `valor_total_pacote` | Valor total (aluguel + condom√≠nio + IPTU) |

---

### **6. COMODIDADES (NOVO)**

**Switches de comodidades rastreados:**
- `ArCondicionado-advanced` ‚Üí `comodidade_arcondicionado`
- `Lareira-advanced` ‚Üí `comodidade_lareira`
- `Lavanderia-advanced` ‚Üí `comodidade_lavanderia`
- `Sauna-advanced` ‚Üí `comodidade_sauna`
- `Elevador-advanced` ‚Üí `comodidade_elevador`

**Evento:** `search_filter_toggle`

---

### **7. LAZER E ESPORTE (NOVO)**

**Switches de lazer rastreados:**
- `Churrasqueira-advanced` ‚Üí `lazer_churrasqueira`
- `Piscina-advanced` ‚Üí `lazer_piscina`
- `Academia-advanced` ‚Üí `lazer_academia`
- `Playground-advanced` ‚Üí `lazer_playground`
- `SalaoFestas-advanced` ‚Üí `lazer_salaofestas`
- `SalaoJogos-advanced` ‚Üí `lazer_salaojogos`

---

### **8. C√îMODOS (NOVO)**

**Switches de c√¥modos rastreados:**
- `AreaServico-advanced` ‚Üí `comodo_areaservico`
- `Varanda-advanced` ‚Üí `comodo_varanda`

---

### **9. SEGURAN√áA (NOVO)**

**Switches de seguran√ßa rastreados:**
- `Alarme-advanced` ‚Üí `seguranca_alarme`
- `CircuitoFechadoTV-advanced` ‚Üí `seguranca_circuitofechadotv`
- `Interfone-advanced` ‚Üí `seguranca_interfone`
- `Portaria24Hrs-advanced` ‚Üí `seguranca_portaria24hrs`

---

## üë§ RASTREAMENTO DE JORNADA DO USU√ÅRIO (USER JOURNEY)

### **Conceito:**
Cada visitante recebe um **User ID persistente** armazenado em `localStorage`, permitindo rastreamento entre m√∫ltiplas visitas.

### **Implementa√ß√£o:**

#### **1. User ID**
```javascript
// Gerado no primeiro acesso
user_id: "user_1729180234567_abc123xyz"

// Armazenado em: localStorage.getItem('ih_user_id')
// Persiste entre sess√µes ‚úÖ
```

#### **2. Session ID**
```javascript
// Nova sess√£o a cada 30 minutos de inatividade
session_id: "session_1729180234567_def456"

// Armazenado em: localStorage.getItem('ih_session_id')
// Expira ap√≥s 30min de inatividade ‚úÖ
```

#### **3. Journey Pages**
Array de p√°ginas visitadas pelo usu√°rio:
```javascript
[
  {
    url: "https://site.com/",
    title: "Home",
    timestamp: 1729180234567
  },
  {
    url: "https://site.com/venda/residencial",
    title: "Im√≥veis √† Venda",
    timestamp: 1729180245678
  },
  {
    url: "https://site.com/imovel/2587/...",
    title: "Terreno Village...",
    timestamp: 1729180256789
  }
]

// Armazenado em: localStorage.getItem('ih_journey_pages')
// Mant√©m √∫ltimas 20 p√°ginas ‚úÖ
```

#### **4. Contexto Adicionado a TODOS os Eventos**
```javascript
{
  // Dados do evento espec√≠fico
  field: "quartos",
  value: "3",

  // + Contexto de jornada (autom√°tico)
  user_id: "user_123...",
  session_id: "session_456...",
  page_depth: 5,              // N√∫mero de p√°ginas visitadas
  time_on_site: 240,          // Tempo total no site (segundos)
  returning_visitor: true     // Se j√° visitou antes
}
```

---

## üéØ FUNIL DE CONVERS√ÉO

### **Stages Rastreados:**

```
1. session_start
   ‚Üì (usu√°rio chega ao site)

2. search_submitted
   ‚Üì (usu√°rio faz uma busca)

3. viewed_property
   ‚Üì (clicou em um im√≥vel)

4. clicked_saber_mais
   ‚Üì (clicou em "Saber Mais" na listagem)

5. property_page_view
   ‚Üì (acessou p√°gina do im√≥vel)

6. opened_contact_form
   ‚Üì (clicou em "MAIS INFORMA√á√ïES")

7. submitted_contact_form
   ‚Üì (enviou formul√°rio de contato)

8. clicked_fazer_proposta | clicked_alugar_imovel
   ‚Üì (a√ß√µes diretas de convers√£o)

9. conversion_contact_form | conversion_whatsapp | conversion_phone
   ‚Üì (CONVERS√ÉO FINAL!)
```

### **Evento de Funil:**

**funnel_stage_reached**
```javascript
{
  stage: "viewed_property",
  funnel_length: 3,
  previous_stage: "search_submitted",
  user_id: "user_123...",
  session_id: "session_456...",
  // ... journey context
}
```

### **Recuperar Funil Completo:**
```javascript
// No console do navegador
MyAnalytics.getFunnel()

// Retorna:
[
  { stage: "session_start", timestamp: 1729180234567, url: "..." },
  { stage: "search_submitted", timestamp: 1729180245678, url: "..." },
  { stage: "viewed_property", timestamp: 1729180256789, url: "..." },
  { stage: "contacted_whatsapp", timestamp: 1729180267890, url: "..." }
]
```

---

## üìä EVENTO PRINCIPAL: search_submit

### **Payload Completo:**

Quando usu√°rio clica em "BUSCAR", captura **TODOS** os filtros ativos:

```javascript
{
  // Meta
  source: "main_form" | "sidebar_form" | "codigo",
  timestamp: 1729180234567,

  // B√°sicos
  finalidade: "venda",
  tipos: ["apartamento", "casa"],
  cidades: ["sao-paulo", "campinas"],
  bairros: ["jardins", "centro"],

  // Avan√ßados - AGORA CAPTURADOS ‚úÖ
  quartos: ["2", "3"],
  suites: ["2"],
  banheiros: ["2"],
  vagas: ["2"],

  // Comercial
  salas: [],
  galpoes: [],

  // Valores
  preco_venda: { min: "200000", max: "500000" },
  preco_aluguel: { min: "0", max: "unlimited" },
  preco_min_manual: "250000",
  preco_max_manual: "480000",

  // √Årea
  area: { min: "50", max: "200" },
  area_min_manual: "",
  area_max_manual: "",

  // Switches b√°sicos
  mobiliado: false,
  semi_mobiliado: false,
  promocao: true,
  imovel_novo: false,
  na_planta: false,
  em_construcao: false,
  aceita_permuta: true,
  pet_friendly: true,
  seguro_fianca: false,
  reservado: false,
  valor_total_pacote: false,

  // Comodidades
  comodidades: {
    ar_condicionado: true,
    lareira: false,
    lavanderia: true,
    sauna: false,
    elevador: true
  },

  // Lazer
  lazer: {
    churrasqueira: true,
    piscina: true,
    academia: false,
    playground: true,
    salao_festas: false,
    salao_jogos: false
  },

  // C√¥modos
  comodos: {
    area_servico: true,
    varanda: true
  },

  // Seguran√ßa
  seguranca: {
    alarme: true,
    circuito_tv: false,
    interfone: true,
    portaria_24h: true
  },

  // Journey context (autom√°tico)
  user_id: "user_123...",
  session_id: "session_456...",
  page_depth: 5,
  time_on_site: 240,
  returning_visitor: true,
  journey_length: 5
}
```

---

## üó∫Ô∏è MAPEAMENTO COMPLETO - HTML ‚Üí EVENTOS

### **Formul√°rio Principal (home-search-form)**

| Elemento HTML | Input Name/ID | Evento Capturado | Campo no Payload |
|--------------|---------------|------------------|------------------|
| Select Finalidade | `#property-status` | `search_filter_changed` | `finalidade` |
| Select Tipos | `#residencial-property-type` | `search_filter_changed` | `tipo` |
| Select Cidades | `#search-field-cidade` | `search_filter_city` | `cidades` |
| Select Bairros | `#search-field-cidadebairro` | `search_filter_bairro` | `bairros` |

### **Filtros Avan√ßados (Collapse)**

| Elemento | Input Name | Tipo | Evento | Campo |
|----------|-----------|------|--------|-------|
| Quartos | `dormitorios[]` | Checkbox | `search_filter_group_changed` | `quartos` |
| Su√≠tes | `suites[]` | Radio | `search_filter_group_changed` | `suites` |
| Banheiros | `banheiros[]` | Radio | `search_filter_group_changed` | `banheiros` |
| Vagas | `vagas[]` | Radio | `search_filter_group_changed` | `vagas` |
| Salas | `salas[]` | Checkbox | `search_filter_group_changed` | `salas_comercial` |
| Galp√µes | `galpoes[]` | Checkbox | `search_filter_group_changed` | `galpoes` |

### **Sliders**

| Slider | Input ID | Evento | Campo |
|--------|----------|--------|-------|
| Valor Venda | `#input-slider-valor-venda` | `search_filter_range_changed` | `preco_venda` |
| Valor Aluguel | `#input-slider-valor-aluguel` | `search_filter_range_changed` | `preco_aluguel` |
| √Årea | `#input-slider-area` | `search_filter_range_changed` | `area` |

### **Inputs Manuais (NOVO)**

| Input | ID | Evento | Campo |
|-------|-----|--------|-------|
| Pre√ßo M√≠nimo | `#input-number-valor-min` | `search_filter_manual_input` | `preco_min_manual` |
| Pre√ßo M√°ximo | `#input-number-valor-max` | `search_filter_manual_input` | `preco_max_manual` |
| √Årea M√≠nima | `#input-number-area-min` | `search_filter_manual_input` | `area_min_manual` |
| √Årea M√°xima | `#input-number-area-max` | `search_filter_manual_input` | `area_max_manual` |

### **Switches/Toggles**

| Switch | ID | Evento | Campo |
|--------|-----|--------|-------|
| Mobiliado | `#filtermobiliado` | `search_filter_toggle` | `mobiliado` |
| Semi Mobiliado | `#filtersemimobiliado` | `search_filter_toggle` | `semi_mobiliado` |
| Ofertas | `#filterpromocao` | `search_filter_toggle` | `promocao_ofertas` |
| Im√≥vel Novo | `#filternovo` | `search_filter_toggle` | `imovel_novo` |
| Na Planta | `#filternaplanta` | `search_filter_toggle` | `na_planta` |
| Em Constru√ß√£o | `#filterconstrucao` | `search_filter_toggle` | `em_construcao` |
| Aceita Permuta | `#filterpermuta` | `search_filter_toggle` | `aceita_permuta` |
| Pet Friendly | `#filterpet` | `search_filter_toggle` | `pet_friendly` |
| Seguro Fian√ßa | `#filtersegfianca` | `search_filter_toggle` | `seguro_fianca` |
| Reservado | `#filterproposta` | `search_filter_toggle` | `reservado` |
| Valor Total | `#filterpacote` | `search_filter_toggle` | `valor_total_pacote` |

---

## üé® RASTREAMENTO DE INTERA√á√ïES NA P√ÅGINA DE RESULTADOS

### **1. Clique em Im√≥vel**

**Evento:** `results_item_click`
```javascript
{
  target: "https://site.com/imovel/2587/...",
  kind: "imovel",
  codigo: "2587",
  user_id: "...",
  session_id: "..."
}
```

### **2. Clique em "SABER MAIS"**

**Evento:** `results_saber_mais_click`
```javascript
{
  codigo: "2587",
  href: "https://site.com/imovel/2587/...",
  user_id: "...",
  session_id: "..."
}
```

### **3. Toggle de Favoritos**

**Evento:** `favorite_toggle`
```javascript
{
  codigo: "2587",
  action: "add" | "remove",
  user_id: "...",
  session_id: "..."
}
```

### **4. Ordena√ß√£o de Resultados (NOVO)**

**Evento:** `results_order_changed`
```javascript
{
  order_by: "precoDesc" | "precoAsc" | "maior_dormitorio" | ...,
  user_id: "...",
  session_id: "..."
}
```

### **5. Expans√£o de Filtros Avan√ßados (NOVO)**

**Evento:** `advanced_filters_toggle`
```javascript
{
  action: "expand" | "collapse",
  user_id: "...",
  session_id: "..."
}
```

---

## üéØ CONVERS√ïES

### **Eventos de Convers√£o:**

#### **conversion_whatsapp_click**
```javascript
{
  codigo: "2587",
  href: "https://wa.me/...",
  user_id: "...",
  session_id: "..."
}
```

#### **conversion_phone_click**
```javascript
{
  codigo: "2587",
  href: "tel:+5511999999999",
  user_id: "...",
  session_id: "..."
}
```

#### **conversion_email_click**
```javascript
{
  codigo: "2587",
  href: "mailto:contato@site.com",
  user_id: "...",
  session_id: "..."
}
```

---

## üìà EVENTOS DE ENGAJAMENTO (NOVOS)

### **1. Scroll Depth**

**Evento:** `scroll_depth`

Disparado em 25%, 50%, 75% e 100% do scroll:
```javascript
{
  depth: 50, // percentage
  user_id: "...",
  session_id: "..."
}
```

### **2. Time on Page**

**Evento:** `page_exit`

Disparado quando usu√°rio sai da p√°gina:
```javascript
{
  time_on_page: 120, // seconds
  max_scroll_depth: 75, // percentage
  user_id: "...",
  session_id: "..."
}
```

### **3. Session Start**

**Evento:** `session_start`

Disparado no in√≠cio de cada sess√£o:
```javascript
{
  session_id: "session_456...",
  referrer: "https://google.com/...",
  landing_page: "https://site.com/",
  user_id: "..."
}
```

---

## üîÑ COMPARA√á√ÉO: SCRIPT ORIGINAL vs ENHANCED

| Recurso | Original | Enhanced |
|---------|----------|----------|
| Finalidade | ‚úÖ | ‚úÖ |
| Tipos | ‚úÖ | ‚úÖ |
| Cidades/Bairros | ‚úÖ | ‚úÖ |
| Sliders (Valor/√Årea) | ‚úÖ | ‚úÖ |
| **Quartos** | ‚ùå | ‚úÖ **NOVO** |
| **Su√≠tes** | ‚ùå | ‚úÖ **NOVO** |
| **Banheiros** | ‚ùå | ‚úÖ **NOVO** |
| **Vagas** | ‚ùå | ‚úÖ **NOVO** |
| **Inputs Manuais** | ‚ùå | ‚úÖ **NOVO** |
| Switches B√°sicos | ‚ö†Ô∏è Parcial | ‚úÖ **COMPLETO** |
| **Comodidades** | ‚ùå | ‚úÖ **NOVO** |
| **Lazer** | ‚ùå | ‚úÖ **NOVO** |
| **C√¥modos** | ‚ùå | ‚úÖ **NOVO** |
| **Seguran√ßa** | ‚ùå | ‚úÖ **NOVO** |
| **User Journey** | ‚ùå | ‚úÖ **NOVO** |
| **Session Tracking** | ‚ùå | ‚úÖ **NOVO** |
| **Funnel Tracking** | ‚ùå | ‚úÖ **NOVO** |
| **Scroll Depth** | ‚ùå | ‚úÖ **NOVO** |
| **Time on Page** | ‚ùå | ‚úÖ **NOVO** |
| **Favoritos** | ‚ùå | ‚úÖ **NOVO** |
| **Ordena√ß√£o** | ‚ùå | ‚úÖ **NOVO** |
| Convers√µes | ‚úÖ | ‚úÖ **ENHANCED** |

---

## üöÄ COMO USAR

### **1. Instalar o Script Enhanced**

No site do cliente, substituir:
```html
<!-- Antes -->
<script src="/static/capture-filtros.js"></script>

<!-- Depois -->
<script src="/static/capture-filtros-enhanced.js"></script>
```

### **2. Acessar Dados no Console**

```javascript
// Ver User ID
MyAnalytics.getUserId()
// ‚Üí "user_1729180234567_abc123"

// Ver Session ID
MyAnalytics.getSessionId()
// ‚Üí "session_1729180245678_def456"

// Ver Jornada Completa
MyAnalytics.getJourney()
// ‚Üí Array de p√°ginas visitadas

// Ver Funil de Convers√£o
MyAnalytics.getFunnel()
// ‚Üí Array de stages do funil

// Limpar Dados (para testes)
MyAnalytics.clearJourney()
```

### **3. Ativar Debug Mode**

```javascript
// No console
MyAnalytics.debug = true

// Ou no script:
window.MyAnalytics.debug = true;
```

Agora ver√° logs de todos os eventos capturados no console! üîç

---

## üìä QUERIES NO POSTHOG

### **Query 1: Funil de Convers√£o Completo**

```sql
SELECT
  event,
  COUNT(DISTINCT properties.user_id) as unique_users,
  COUNT(*) as total_events
FROM events
WHERE
  event IN (
    'session_start',
    'search_submitted',
    'viewed_property',
    'clicked_saber_mais',
    'favorited_property',
    'contacted_whatsapp',
    'contacted_phone',
    'contacted_email'
  )
  AND timestamp >= now() - INTERVAL 30 DAY
GROUP BY event
ORDER BY
  CASE event
    WHEN 'session_start' THEN 1
    WHEN 'search_submitted' THEN 2
    WHEN 'viewed_property' THEN 3
    WHEN 'clicked_saber_mais' THEN 4
    WHEN 'favorited_property' THEN 5
    ELSE 6
  END
```

### **Query 2: Filtros Mais Usados (Quartos, Su√≠tes, etc.)**

```sql
SELECT
  properties.field,
  properties.value,
  COUNT(*) as count
FROM events
WHERE
  event = 'search_filter_group_changed'
  AND properties.field IN ('quartos', 'suites', 'banheiros', 'vagas')
  AND timestamp >= now() - INTERVAL 30 DAY
GROUP BY properties.field, properties.value
ORDER BY properties.field, count DESC
```

### **Query 3: Jornada M√©dia do Usu√°rio**

```sql
SELECT
  AVG(properties.page_depth) as avg_pages_per_session,
  AVG(properties.time_on_site) as avg_time_on_site_seconds,
  SUM(CASE WHEN properties.returning_visitor = true THEN 1 ELSE 0 END) / COUNT(*) * 100 as returning_visitor_percentage
FROM events
WHERE
  event = 'search_submit'
  AND timestamp >= now() - INTERVAL 30 DAY
```

### **Query 4: Comodidades Mais Buscadas**

```sql
SELECT
  properties.field,
  COUNT(*) as activations
FROM events
WHERE
  event = 'search_filter_toggle'
  AND properties.enabled = true
  AND properties.field LIKE 'comodidade_%'
  AND timestamp >= now() - INTERVAL 30 DAY
GROUP BY properties.field
ORDER BY activations DESC
```

---

## ‚úÖ VERIFICA√á√ÉO: DADOS SENDO CAPTURADOS

### **Checklist Completo:**

#### **Filtros B√°sicos:**
- [x] Finalidade (Venda/Aluguel)
- [x] Tipos de Im√≥vel (Apartamento, Casa, etc.)
- [x] Cidades (m√∫ltiplas)
- [x] Bairros/Condom√≠nios (m√∫ltiplos)

#### **Filtros Avan√ßados - QUANTIDADE:**
- [x] ‚úÖ **Quartos** (1, 2, 3, 4+)
- [x] ‚úÖ **Su√≠tes** (1+, 2+, 3+, 4+)
- [x] ‚úÖ **Banheiros** (1+, 2+, 3+, 4+)
- [x] ‚úÖ **Vagas** (1+, 2+, 3+, 4+)
- [x] ‚úÖ **Salas** (comercial)
- [x] ‚úÖ **Galp√µes** (comercial)

#### **Filtros Avan√ßados - VALORES:**
- [x] ‚úÖ **Slider Valor Venda** (min/max)
- [x] ‚úÖ **Slider Valor Aluguel** (min/max)
- [x] ‚úÖ **Slider √Årea** (min/max)
- [x] ‚úÖ **Input Manual Pre√ßo M√≠nimo**
- [x] ‚úÖ **Input Manual Pre√ßo M√°ximo**
- [x] ‚úÖ **Input Manual √Årea M√≠nima**
- [x] ‚úÖ **Input Manual √Årea M√°xima**

#### **Switches/Toggles:**
- [x] ‚úÖ Mobiliado
- [x] ‚úÖ Semi Mobiliado
- [x] ‚úÖ Ofertas/Promo√ß√µes
- [x] ‚úÖ Im√≥vel Novo
- [x] ‚úÖ Na Planta
- [x] ‚úÖ Em Constru√ß√£o
- [x] ‚úÖ Aceita Permuta
- [x] ‚úÖ Pet Friendly
- [x] ‚úÖ Seguro Fian√ßa
- [x] ‚úÖ Reservado
- [x] ‚úÖ Valor Total (Pacote)

#### **Comodidades:**
- [x] ‚úÖ Ar Condicionado
- [x] ‚úÖ Lareira
- [x] ‚úÖ Lavanderia
- [x] ‚úÖ Sauna
- [x] ‚úÖ Elevador

#### **Lazer e Esporte:**
- [x] ‚úÖ Churrasqueira
- [x] ‚úÖ Piscina
- [x] ‚úÖ Academia
- [x] ‚úÖ Playground
- [x] ‚úÖ Sal√£o de Festas
- [x] ‚úÖ Sal√£o de Jogos

#### **C√¥modos:**
- [x] ‚úÖ √Årea de Servi√ßo
- [x] ‚úÖ Varanda

#### **Seguran√ßa:**
- [x] ‚úÖ Alarme
- [x] ‚úÖ Circuito Fechado de TV
- [x] ‚úÖ Interfone
- [x] ‚úÖ Portaria 24 Horas

#### **Rastreamento de Jornada:**
- [x] ‚úÖ User ID persistente
- [x] ‚úÖ Session ID (30min timeout)
- [x] ‚úÖ Journey pages (√∫ltimas 20)
- [x] ‚úÖ Page depth (n√∫mero de p√°ginas visitadas)
- [x] ‚úÖ Time on site (tempo total)
- [x] ‚úÖ Returning visitor detection
- [x] ‚úÖ Referrer tracking
- [x] ‚úÖ Landing page tracking

#### **Funil de Convers√£o:**
- [x] ‚úÖ Session start
- [x] ‚úÖ Search submitted
- [x] ‚úÖ Viewed property
- [x] ‚úÖ Clicked "Saber Mais"
- [x] ‚úÖ Property page view
- [x] ‚úÖ Opened contact form
- [x] ‚úÖ Contact form started
- [x] ‚úÖ Contact form submitted
- [x] ‚úÖ Favorited property
- [x] ‚úÖ Contacted (WhatsApp/Phone/Email/Form)

#### **Engajamento:**
- [x] ‚úÖ Scroll depth (25%, 50%, 75%, 100%)
- [x] ‚úÖ Time on page
- [x] ‚úÖ Page exit tracking

#### **P√°gina do Im√≥vel (NOVO):**
- [x] ‚úÖ Property page view
- [x] ‚úÖ CTA "Fazer Proposta"
- [x] ‚úÖ CTA "Alugar Este Im√≥vel"
- [x] ‚úÖ CTA "Mais Informa√ß√µes"
- [x] ‚úÖ Formul√°rio de contato completo
- [x] ‚úÖ Rastreamento de campos individuais
- [x] ‚úÖ Detec√ß√£o de abandono do form
- [x] ‚úÖ Taxa de rejei√ß√£o (bounce rate)
- [x] ‚úÖ Galeria de fotos (navega√ß√£o)
- [x] ‚úÖ Share e favoritar

---

## üéØ RESPOSTA √ÄS PERGUNTAS

### **1. "Dados de quartos, su√≠tes, banheiros, vagas est√£o sendo capturados?"**

‚úÖ **SIM, no script enhanced!**

**Script original:** ‚ùå N√£o capturava
**Script enhanced:** ‚úÖ Captura tudo via `search_filter_group_changed`

**Evid√™ncia no c√≥digo:**
```javascript
// Linha 87-93 do capture-filtros-enhanced.js
trackCheckboxGroup("dormitorios[]", "quartos");
trackCheckboxGroup("suites[]", "suites");
trackCheckboxGroup("banheiros[]", "banheiros");
trackCheckboxGroup("vagas[]", "vagas");
```

### **2. "Valores e filtros est√£o sendo capturados?"**

‚úÖ **SIM, completamente!**

**Sliders:** ‚úÖ Min e Max separados
**Inputs manuais:** ‚úÖ Agora capturados (novo)
**Todos os switches:** ‚úÖ Todos os 11+ toggles

### **3. "Rastrear o usu√°rio para trazer jornada de convers√£o?"**

‚úÖ **SIM, implementado!**

**User Journey Features:**
- ‚úÖ User ID persistente (cross-session)
- ‚úÖ Session ID (com timeout 30min)
- ‚úÖ P√°ginas visitadas (√∫ltimas 20)
- ‚úÖ Profundidade de navega√ß√£o
- ‚úÖ Tempo total no site
- ‚úÖ Detec√ß√£o de visitante retornante
- ‚úÖ Funil de convers√£o completo

**Como funciona:**
1. Usu√°rio acessa site ‚Üí `session_start` + gera `user_id`
2. Navega entre p√°ginas ‚Üí cada p√°gina adicionada ao journey
3. Faz busca ‚Üí `search_submit` com contexto completo
4. Clica em im√≥vel ‚Üí `viewed_property` + `funnel_stage_reached`
5. Acessa p√°gina ‚Üí `property_page_view`
6. Clica "Mais Informa√ß√µes" ‚Üí `opened_contact_form`
7. Preenche formul√°rio ‚Üí campos rastreados individualmente
8. Envia formul√°rio ‚Üí `conversion_contact_form` ‚úÖ

**Todos os eventos incluem contexto:**
```javascript
{
  user_id: "user_123...",
  session_id: "session_456...",
  page_depth: 5,
  time_on_site: 240,
  returning_visitor: true
}
```

### **4. "Capturar evento de convers√£o do formul√°rio de contato?"**

‚úÖ **SIM, implementado completamente!**

**Eventos do formul√°rio:**
- `opened_contact_form` - Abriu modal
- `contact_form_started` - Come√ßou a preencher
- `contact_form_field_focus` - Focou em campo (nome/email/telefone/mensagem)
- `contact_form_field_filled` - Preencheu campo
- `contact_form_submit` - Enviou formul√°rio
- `conversion_contact_form` - **CONVERS√ÉO PRINCIPAL** ‚úÖ
- `contact_form_abandoned` - Abandonou com dados parciais

**Taxa de rejei√ß√£o rastreada:**
- `bounce_detected` - Hard bounce (1 p√°gina + <10s)
- `bounce_detected` - Quick exit (<30s + scroll <25%)

**Associa√ß√£o ao usu√°rio:**
Todos os eventos incluem `user_id` e `session_id` para rastreamento completo da jornada!

---

## üé® DASHBOARD INSIGHTS POSS√çVEIS

Com estes dados voc√™ pode criar:

### **1. Funil de Convers√£o Visual**
```
Visitantes (session_start): 1000
  ‚Üì 45%
Buscas (search_submit): 450
  ‚Üì 40%
Visualiza√ß√µes (viewed_property): 180
  ‚Üì 25%
Cliques "Saber Mais": 45
  ‚Üì 55%
Convers√µes (WhatsApp/Phone): 25
```

### **2. Filtros Mais Usados**
- "2 quartos" ‚Üí 35% das buscas
- "Pet Friendly" ‚Üí 28% das buscas
- "Piscina" ‚Üí 22% das buscas

### **3. Jornada M√©dia**
- P√°ginas por sess√£o: 4.5
- Tempo m√©dio no site: 3min 45s
- % Visitantes retornantes: 32%

### **4. Perfil do Comprador**
- Busca mais comum: "Casa, 3 quartos, 2-3 vagas, R$ 500k-1M"
- Comodidade preferida: "Piscina"
- Cidade top: "S√£o Paulo"

---

## üìù PR√ìXIMOS PASSOS

### **Para Implementar:**

1. **Substituir o script atual:**
   ```html
   <script src="/static/capture-filtros-enhanced.js"></script>
   ```

2. **Testar no navegador:**
   - Abrir console
   - Ativar debug: `MyAnalytics.debug = true`
   - Interagir com filtros
   - Ver eventos sendo capturados ‚úÖ

3. **Verificar no PostHog:**
   - Acessar projeto PostHog
   - Ir em "Events" ‚Üí ver novos eventos
   - Criar insights com os novos dados

4. **Criar Dashboards:**
   - Funil de convers√£o
   - Filtros mais usados
   - Jornadas completas
   - Perfil de visitantes

---

## üéâ CONCLUS√ÉO

### **‚úÖ RESPOSTA DEFINITIVA:**

**Pergunta 1:** "Os dados de quartos, su√≠tes, banheiros, vagas, filtros, valores est√£o realmente sendo capturados?"

**Resposta:**
- ‚ùå **Script original**: N√£o capturava quartos, su√≠tes, banheiros, vagas
- ‚úÖ **Script enhanced**: Captura **TUDO**, incluindo:
  - Quartos, su√≠tes, banheiros, vagas ‚úÖ
  - Todos os sliders e inputs manuais ‚úÖ
  - Todos os 30+ switches/toggles ‚úÖ
  - Comodidades, lazer, c√¥modos, seguran√ßa ‚úÖ

**Pergunta 2:** "Rastrear usu√°rio para trazer jornada de convers√£o?"

**Resposta:**
‚úÖ **SIM! Implementado sistema completo:**
- User ID persistente (cross-session) ‚úÖ
- Session tracking (30min timeout) ‚úÖ
- Journey pages (√∫ltimas 20 visitadas) ‚úÖ
- Funnel stages (7 stages rastreados) ‚úÖ
- Contexto autom√°tico em todos eventos ‚úÖ

---

**Status:** üü¢ **COMPLETO E PRONTO PARA USO**

**Cobertura:** 100% dos filtros + Journey Tracking + Funnel

**Documenta√ß√£o:** Este arquivo + coment√°rios inline no script

